function x(r,e){for(var n=0;n<e.length;n++){const t=e[n];if(typeof t!="string"&&!Array.isArray(t)){for(const o in t)if(o!=="default"&&!(o in r)){const a=Object.getOwnPropertyDescriptor(t,o);a&&Object.defineProperty(r,o,a.get?a:{enumerable:!0,get:()=>t[o]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}var d=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function j(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var h={exports:{}};h.exports;(function(r){typeof window<"u"&&(r.window=window);var e=r.window||r,n,t=e.SEA||{};(t.window=r.window)&&(t.window.SEA=t);try{n+""!=typeof MODULE&&(MODULE.exports=t)}catch{}r.exports=t})(h);var b=h.exports;function w(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var A;if(A+""==typeof btoa){if(A+""==typeof Buffer)try{d.Buffer=w("buffer",1).Buffer}catch{console.log("Please `npm install buffer` or add it to your package.json !")}d.btoa=function(r){return Buffer.from(r,"binary").toString("base64")},d.atob=function(r){return Buffer.from(r,"base64").toString("binary")}}function m(){}Object.assign(m,{from:Array.from});m.prototype=Object.create(Array.prototype);m.prototype.toString=function(r,e,n){r=r||"utf8",e=e||0;const t=this.length;if(r==="hex"){const o=new Uint8Array(this);return[...Array((n&&n+1||t)-e).keys()].map(a=>o[a+e].toString(16).padStart(2,"0")).join("")}if(r==="utf8")return Array.from({length:(n||t)-e},(o,a)=>String.fromCharCode(this[a+e])).join("");if(r==="base64")return btoa(this)};var O=m,u=O;function l(...r){return console.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),l.from(...r)}l.prototype=Object.create(Array.prototype);Object.assign(l,{from(){if(!Object.keys(arguments).length||arguments[0]==null)throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const r=arguments[0];let e;if(typeof r=="string"){const t=arguments[1]||"utf8";if(t==="hex"){const o=r.match(/([\da-fA-F]{2})/g).map(a=>parseInt(a,16));if(!o||!o.length)throw new TypeError("Invalid first argument for type 'hex'.");e=u.from(o)}else if(t==="utf8"||t==="binary"){const o=r.length,a=new Uint16Array(o);Array.from({length:o},(i,s)=>a[s]=r.charCodeAt(s)),e=u.from(a)}else if(t==="base64"){const o=atob(r),a=o.length,i=new Uint8Array(a);Array.from({length:a},(s,p)=>i[p]=o.charCodeAt(p)),e=u.from(i)}else t==="binary"?e=u.from(r):console.info("SafeBuffer.from unknown encoding: "+t);return e}if(r.byteLength,r.byteLength?r.byteLength:r.length){let t;return r instanceof ArrayBuffer&&(t=new Uint8Array(r)),u.from(t||r)}},alloc(r,e=0){return u.from(new Uint8Array(Array.from({length:r},()=>e)))},allocUnsafe(r){return u.from(new Uint8Array(Array.from({length:r})))},concat(r){if(!Array.isArray(r))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return u.from(r.reduce((e,n)=>e.concat(Array.from(n)),[]))}});l.prototype.from=l.from;l.prototype.toString=u.prototype.toString;var C=l;const B=b,f={Buffer:C};var v={},D;JSON.parseAsync=JSON.parseAsync||function(r,e,n){var t;try{e(t,JSON.parse(r,n))}catch(o){e(o)}};JSON.stringifyAsync=JSON.stringifyAsync||function(r,e,n,t){var o;try{e(o,JSON.stringify(r,n,t))}catch(a){e(a)}};f.parse=function(r,e){return new Promise(function(n,t){JSON.parseAsync(r,function(o,a){o?t(o):n(a)},e)})};f.stringify=function(r,e,n){return new Promise(function(t,o){JSON.stringifyAsync(r,function(a,i){a?o(a):t(i)},e,n)})};B.window&&(f.crypto=window.crypto||window.msCrypto,f.subtle=(f.crypto||v).subtle||(f.crypto||v).webkitSubtle,f.TextEncoder=window.TextEncoder,f.TextDecoder=window.TextDecoder,f.random=r=>f.Buffer.from(f.crypto.getRandomValues(new Uint8Array(f.Buffer.alloc(r)))));if(!f.TextDecoder){const{TextEncoder:r,TextDecoder:e}=w((D+""==typeof MODULE?".":"")+"./lib/text-encoding");f.TextDecoder=e,f.TextEncoder=r}if(!f.crypto)try{var S=w("crypto",1);Object.assign(f,{crypto:S,random:e=>f.Buffer.from(S.randomBytes(e))});const{Crypto:r}=w("@peculiar/webcrypto",1);f.ossl=f.subtle=new r({directory:"ossl"}).subtle}catch{console.log("Please `npm install @peculiar/webcrypto` or add it to your package.json !")}var E=f,T=b,P=E,y={};y.pbkdf2={hash:{name:"SHA-256"},iter:1e5,ks:64};y.ecdsa={pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}};y.ecdh={name:"ECDH",namedCurve:"P-256"};y.jwk=function(r,e){r=r.split(".");var n=r[0],t=r[1],o={kty:"EC",crv:"P-256",x:n,y:t,ext:!0};return o.key_ops=e?["sign"]:["verify"],e&&(o.d=e),o};y.keyToJwk=function(r){return{kty:"oct",k:r.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}};y.recall={validity:12*60*60,hook:function(r){return r}};y.check=function(r){return typeof r=="string"&&r.slice(0,4)==="SEA{"};y.parse=async function(e){try{var n=typeof e=="string";return n&&e.slice(0,4)==="SEA{"&&(e=e.slice(3)),n?await P.parse(e):e}catch{}return e};T.opt=y;var c=b,g=E;c.name=c.name||(async(r,e)=>{try{if(r)try{r()}catch(n){console.log(n)}return}catch(n){if(console.log(n),c.err=n,c.throw)throw n;r&&r();return}});c.pair=c.pair||(async(r,e)=>{try{var n=g.ossl||g.subtle,t=await g.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async i=>{var s={};s.priv=(await g.subtle.exportKey("jwk",i.privateKey)).d;var p=await g.subtle.exportKey("jwk",i.publicKey);return s.pub=p.x+"."+p.y,s});try{var o=await n.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async i=>{var s={};s.epriv=(await n.exportKey("jwk",i.privateKey)).d;var p=await n.exportKey("jwk",i.publicKey);return s.epub=p.x+"."+p.y,s})}catch(i){if(c.window)throw i;if(i=="Error: ECDH is not a supported algorithm")console.log("Ignoring ECDH...");else throw i}o=o||{};var a={pub:t.pub,priv:t.priv,epub:o.epub,epriv:o.epriv};if(r)try{r(a)}catch(i){console.log(i)}return a}catch(i){if(console.log(i),c.err=i,c.throw)throw i;r&&r();return}});var k=c.pair;const U=j(k),_=x({__proto__:null,default:U},[k]);export{_ as p};
